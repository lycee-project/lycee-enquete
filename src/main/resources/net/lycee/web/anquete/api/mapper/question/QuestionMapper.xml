<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.lycee.web.anquete.api.mapper.question.QuestionMapper">

    <resultMap
            id="questionEntity"
            type="net.lycee.web.anquete.api.entity.QuestionEntity">
        <id column="QUESTION_ID" jdbcType="VARCHAR" property="questionId" />

        <result column="SPACE_ID" jdbcType="VARCHAR" property="spaceId" />
        <result column="QUESTION_NO" jdbcType="INTEGER" property="no" />
        <result column="TYPE" jdbcType="INTEGER" property="type" />
        <result column="DESCRIPTION" jdbcType="VARCHAR" property="description" />
        <result column="END_TIME" jdbcType="BIGINT" property="closeTime" />
        <collection property="answers" ofType="net.lycee.web.anquete.api.entity.AnswerEntity" javaType="list">
            <id column="ANSWER_ID" jdbcType="VARCHAR" property="answerId" />
            <result column="ANSWER_NO" jdbcType="INTEGER" property="no" />
            <result column="ANSWER_DESCRIPTION" jdbcType="VARCHAR" property="description" />
        </collection>
    </resultMap>


    <select id="readQuestions" resultMap="questionEntity">
        SELECT
            QQ.QUESTION_ID,
            QQ.SPACE_ID,
            QQ.QUESTION_NO,
            QQ.TYPE,
            QQ.DESCRIPTION,
            QQ.END_TIME,

            -- answers
            QA.ANSWER_ID,
            QA.ANSWER_NO,
            QA.DESCRIPTION AS ANSWER_DESCRIPTION
        FROM
            QES_QUESTION QQ
        INNER JOIN
            QES_ANSWER QA
        ON
            QQ.QUESTION_ID = QA.QUESTION_ID
        WHERE
            QQ.SPACE_ID = #{spaceId}
    </select>

</mapper>